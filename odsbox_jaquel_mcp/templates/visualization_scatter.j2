import matplotlib.pyplot as plt

# Number of submatrices
num_of_plots = {{ submatrices_count }}

# Calculate number of rows
cols = {{ subplots_per_row }}
rows = (num_of_plots + cols - 1) // cols  # Ceiling division

fig, axes = plt.subplots(
    rows, cols,
    figsize=({{ figsize_width }}, {{ figsize_height_per_row }} * rows)
)
axes = axes.flatten()  # Flatten to 1D array for easy indexing

for i, measurement_data in enumerate(measurement_data_items):
    ax = axes[i]
    measurement_data["data"].plot.scatter(
        x="{{ x_qty }}",
        y="{{ y_qty }}",
        c=measurement_data["data"].index,
        colormap="viridis",
        ax=ax,
        alpha=0.7,
        s=20
    )
    ax.set_xlabel(measurement_data["labels"].get("{{ x_qty }}", "{{ x_qty }}"))
    ax.set_ylabel(measurement_data["labels"].get("{{ y_qty }}", "{{ y_qty }}"))
    ax.set_title(measurement_data["title"])

# Hide any unused subplots
for j in range(i + 1, len(axes)):
    axes[j].axis('off')

plt.tight_layout()
plt.show()
